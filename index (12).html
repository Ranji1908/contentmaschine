<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Szenen Generator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        .icon {
            display: inline-block;
            width: 1em;
            height: 1em;
            stroke-width: 0;
            stroke: currentColor;
            fill: currentColor;
        }
    </style>
</head>
<body>
    <!--
    VIDEO SZENEN GENERATOR - SERVER DEPLOYMENT SETUP
    
    FTP/Server Ordnerstruktur:
    
    your-website/
    ├── index.html                    (diese Datei)
    ├── images/
    │   └── avatars/
    │       ├── sarah-martinez.jpg
    │       ├── michael-weber.jpg
    │       ├── anna-mueller.jpg
    │       ├── david-chen.jpg
    │       ├── emma-thompson.jpg
    │       └── luis-rodriguez.jpg
    ├── audio/
    │   └── music/
    │       ├── energetic-corporate.mp3
    │       ├── peaceful-piano.mp3
    │       ├── digital-innovation.mp3
    │       ├── morning-breeze.mp3
    │       ├── rising-success.mp3
    │       ├── smooth-business.mp3
    │       ├── clean-simple.mp3
    │       └── friendly-guitar.mp3
    └── api/
        └── webhooks/
            ├── video-upload.php
            ├── image-overlay.php
            ├── image-avatar.php
            ├── ai-video.php
            └── merge-videos.php
    -->
    
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;
        const { createRoot } = ReactDOM;

        function VideoSceneGenerator() {
            const [scenes, setScenes] = useState([
                { 
                    id: 1, 
                    type: 'video-upload', 
                    status: 'pending',
                    overlayText: '',
                    speechText: '',
                    aiDescription: '',
                    selectedAvatar: '',
                    avatarPosition: 'center',
                    avatarType: 'face',
                    animateImage: false,
                    rightsConfirmed: false,
                    videoFile: null,
                    imageFile: null
                }
            ]);
            const [previewScene, setPreviewScene] = useState(null);
            const [showAdmin, setShowAdmin] = useState(false);
            
            // Hilfsfunktion für sicheren localStorage Zugriff
            const safeLocalStorage = {
                getItem: (key) => {
                    try {
                        return localStorage.getItem(key);
                    } catch {
                        return null;
                    }
                },
                setItem: (key, value) => {
                    try {
                        localStorage.setItem(key, value);
                        return true;
                    } catch {
                        console.warn('LocalStorage nicht verfügbar');
                        return false;
                    }
                }
            };
            
            // Musik-Einstellungen
            const [musicEnabled, setMusicEnabled] = useState(() => {
                const saved = safeLocalStorage.getItem('video-generator-music-enabled');
                return saved ? JSON.parse(saved) : false;
            });
            
            const [selectedMusic, setSelectedMusic] = useState(() => {
                return safeLocalStorage.getItem('video-generator-selected-music') || '';
            });
            
            const [playingMusic, setPlayingMusic] = useState(null);
            
            // Webhook-Konfiguration
            const [webhooks, setWebhooks] = useState(() => {
                const saved = safeLocalStorage.getItem('video-generator-webhooks');
                return saved ? JSON.parse(saved) : {
                    'video-upload': './api/webhooks/video-upload.php',
                    'image-overlay': './api/webhooks/image-overlay.php', 
                    'image-avatar': './api/webhooks/image-avatar.php',
                    'ai-video': './api/webhooks/ai-video.php',
                    'merge': './api/webhooks/merge-videos.php'
                };
            });

            // Avatar Daten
            const avatars = [
                { 
                    id: 'annie', 
                    name: 'Annie', 
                    image: './images/avatars/Annie.png', 
                    videoUrl: 'https://your-domain.com/avatar-previews/annie.mp4' 
                },
                { 
                    id: 'briana', 
                    name: 'Briana', 
                    image: './images/avatars/Briana.png', 
                    videoUrl: 'https://your-domain.com/avatar-previews/briana.mp4' 
                },
                { 
                    id: 'byran', 
                    name: 'Byran', 
                    image: './images/avatars/Byran.png', 
                    videoUrl: 'https://your-domain.com/avatar-previews/byran.mp4' 
                },
                { 
                    id: 'colin', 
                    name: 'Colin', 
                    image: './images/avatars/Colin.png', 
                    videoUrl: 'https://your-domain.com/avatar-previews/colin.mp4' 
                },
                { 
                    id: 'conrad', 
                    name: 'Conrad', 
                    image: './images/avatars/Conrad.png', 
                    videoUrl: 'https://your-domain.com/avatar-previews/conrad.mp4' 
                },
                { 
                    id: 'fina', 
                    name: 'Fina', 
                    image: './images/avatars/Fina.png', 
                    videoUrl: 'https://your-domain.com/avatar-previews/fina.mp4' 
                },
                { 
                    id: 'florin', 
                    name: 'Florin', 
                    image: './images/avatars/Florin.png', 
                    videoUrl: 'https://your-domain.com/avatar-previews/florin.mp4' 
                },
                { 
                    id: 'lina', 
                    name: 'Lina', 
                    image: './images/avatars/Lina.png', 
                    videoUrl: 'https://your-domain.com/avatar-previews/lina.mp4' 
                }
            ];

            // Gemafreie Hintergrundmusik
            const backgroundMusic = [
                { id: 'upbeat1', name: 'Energetic Corporate', genre: 'Corporate', duration: '3:24', url: './audio/music/energetic-corporate.mp3' },
                { id: 'calm1', name: 'Peaceful Piano', genre: 'Ambient', duration: '4:12', url: './audio/music/peaceful-piano.mp3' },
                { id: 'tech1', name: 'Digital Innovation', genre: 'Electronic', duration: '2:48', url: './audio/music/digital-innovation.mp3' },
                { id: 'nature1', name: 'Morning Breeze', genre: 'Nature', duration: '5:36', url: './audio/music/morning-breeze.mp3' },
                { id: 'inspire1', name: 'Rising Success', genre: 'Motivational', duration: '3:18', url: './audio/music/rising-success.mp3' },
                { id: 'jazz1', name: 'Smooth Business', genre: 'Jazz', duration: '4:02', url: './audio/music/smooth-business.mp3' },
                { id: 'minimal1', name: 'Clean & Simple', genre: 'Minimal', duration: '2:56', url: './audio/music/clean-simple.mp3' },
                { id: 'acoustic1', name: 'Friendly Guitar', genre: 'Acoustic', duration: '3:44', url: './audio/music/friendly-guitar.mp3' }
            ];

            const addScene = () => {
                const newScene = {
                    id: Date.now(),
                    type: 'video-upload',
                    status: 'pending',
                    overlayText: '',
                    speechText: '',
                    aiDescription: '',
                    selectedAvatar: '',
                    avatarPosition: 'center',
                    avatarType: 'face',
                    animateImage: false,
                    rightsConfirmed: false,
                    videoFile: null,
                    imageFile: null
                };
                setScenes([...scenes, newScene]);
            };

            const updateScene = (id, updates) => {
                setScenes(scenes.map(scene => 
                    scene.id === id ? { ...scene, ...updates } : scene
                ));
            };

            const removeScene = (id) => {
                if (scenes.length > 1) {
                    setScenes(scenes.filter(scene => scene.id !== id));
                }
            };

            // Webhooks speichern
            const updateWebhooks = (newWebhooks) => {
                setWebhooks(newWebhooks);
                safeLocalStorage.setItem('video-generator-webhooks', JSON.stringify(newWebhooks));
            };

            // Musik-Einstellungen speichern
            const updateMusicEnabled = (enabled) => {
                setMusicEnabled(enabled);
                safeLocalStorage.setItem('video-generator-music-enabled', JSON.stringify(enabled));
            };

            const updateSelectedMusic = (musicId) => {
                setSelectedMusic(musicId);
                safeLocalStorage.setItem('video-generator-selected-music', musicId);
            };

            const generateScene = async (sceneId) => {
                const scene = scenes.find(s => s.id === sceneId);
                const webhookUrl = webhooks[scene.type];
                
                updateScene(sceneId, { status: 'generating' });
                
                try {
                    const formData = new FormData();
                    let sceneData = {
                        sceneId: scene.id,
                        type: scene.type
                    };

                    switch (scene.type) {
                        case 'video-upload':
                            sceneData = {
                                ...sceneData,
                                rightsConfirmed: scene.rightsConfirmed || false
                            };
                            if (scene.videoFile) {
                                formData.append('video', scene.videoFile);
                            }
                            break;
                            
                        case 'image-overlay':
                            sceneData = {
                                ...sceneData,
                                overlayText: scene.overlayText || '',
                                speechText: scene.speechText || '',
                                animateImage: scene.animateImage || false,
                                rightsConfirmed: scene.rightsConfirmed || false
                            };
                            if (scene.imageFile) {
                                formData.append('image', scene.imageFile);
                            }
                            break;
                            
                        case 'image-avatar':
                            sceneData = {
                                ...sceneData,
                                overlayText: scene.overlayText || '',
                                speechText: scene.speechText || '',
                                animateImage: scene.animateImage || false,
                                selectedAvatar: scene.selectedAvatar || '',
                                avatarPosition: scene.avatarPosition || 'center',
                                avatarType: scene.avatarType || 'face',
                                rightsConfirmed: scene.rightsConfirmed || false
                            };
                            if (scene.imageFile) {
                                formData.append('image', scene.imageFile);
                            }
                            break;
                            
                        case 'ai-video':
                            sceneData = {
                                ...sceneData,
                                selectedAvatar: scene.selectedAvatar || '',
                                aiDescription: scene.aiDescription || '',
                                style: scene.aiStyle || 'realistic',
                                duration: scene.aiDuration || 'auto'
                            };
                            break;
                    }
                    
                    formData.append('sceneData', JSON.stringify(sceneData));
                    
                    // Echte Webhook-Aufrufe hier aktivieren:
                    // const response = await fetch(webhookUrl, {
                    //   method: 'POST',
                    //   body: formData
                    // });
                    
                    console.log('Szenentyp:', scene.type);
                    console.log('Webhook URL:', webhookUrl);
                    console.log('Scene Data:', sceneData);
                    
                    setTimeout(() => {
                        updateScene(sceneId, { 
                            status: 'completed', 
                            videoUrl: `https://example.com/generated-${scene.type}-${sceneId}.mp4` 
                        });
                    }, 2000);
                    
                } catch (error) {
                    console.error('Webhook-Fehler:', error);
                    updateScene(sceneId, { status: 'error', errorMessage: error.message });
                }
            };

            const regenerateScene = (sceneId) => {
                updateScene(sceneId, { status: 'pending', videoUrl: null });
            };

            const mergeVideos = async () => {
                const completedScenes = scenes.filter(s => s.status === 'completed');
                const selectedMusicTrack = backgroundMusic.find(m => m.id === selectedMusic);
                
                try {
                    const mergeData = {
                        scenes: completedScenes.map(scene => ({
                            id: scene.id,
                            type: scene.type,
                            videoUrl: scene.videoUrl,
                            order: scenes.indexOf(scene) + 1
                        })),
                        music: musicEnabled ? {
                            enabled: true,
                            trackId: selectedMusic,
                            trackName: selectedMusicTrack?.name,
                            trackUrl: selectedMusicTrack?.url,
                            genre: selectedMusicTrack?.genre,
                            duration: selectedMusicTrack?.duration
                        } : { 
                            enabled: false 
                        },
                        finalConfig: {
                            totalScenes: scenes.length,
                            generatedAt: new Date().toISOString(),
                            userAgent: navigator.userAgent
                        }
                    };

                    console.log('Merge Data:', mergeData);
                    alert(`📹 Videos werden zusammengeführt...\n\nSzenen: ${completedScenes.length}\nMusik: ${musicEnabled ? selectedMusicTrack?.name : 'Keine'}`);
                        
                } catch (error) {
                    console.error('Merge-Fehler:', error);
                    alert(`❌ Fehler beim Zusammenführen: ${error.message}`);
                }
            };

            const playMusic = (musicId) => {
                if (playingMusic === musicId) {
                    setPlayingMusic(null);
                } else {
                    setPlayingMusic(musicId);
                    setTimeout(() => setPlayingMusic(null), 3000);
                }
            };

            const allScenesCompleted = scenes.every(scene => scene.status === 'completed');

            return (
                <div className="max-w-4xl mx-auto p-6 bg-gray-50 min-h-screen">
                    <div className="flex justify-between items-center mb-8">
                        <h1 className="text-3xl font-bold text-gray-900">Video Szenen Generator</h1>
                        <button
                            onClick={() => setShowAdmin(true)}
                            className="flex items-center gap-2 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md font-medium transition-colors"
                        >
                            ⚙️ Webhooks
                        </button>
                    </div>
                    
                    <div className="space-y-6">
                        {scenes.map((scene, index) => (
                            <div key={scene.id} className="bg-white rounded-lg shadow-md p-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-semibold text-gray-800">
                                        Szene {index + 1}
                                    </h2>
                                    {scenes.length > 1 && (
                                        <button
                                            onClick={() => removeScene(scene.id)}
                                            className="text-red-600 hover:text-red-800 p-1"
                                        >
                                            ❌
                                        </button>
                                    )}
                                </div>

                                {/* Scene Type Selector */}
                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Szenentyp</label>
                                    <select
                                        value={scene.type}
                                        onChange={(e) => updateScene(scene.id, { type: e.target.value })}
                                        className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    >
                                        <option value="video-upload">Eigenes Video hochladen</option>
                                        <option value="image-overlay">Bild mit Text-Overlay</option>
                                        <option value="image-avatar">Bild mit Avatar</option>
                                        <option value="ai-video">Komplettes KI Video</option>
                                    </select>
                                </div>

                                {/* Scene Fields based on type */}
                                {scene.type === 'video-upload' && (
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Video hochladen</label>
                                        <div className="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors">
                                            <div className="text-4xl mb-2">📁</div>
                                            <div className="text-sm text-gray-600">
                                                {scene.videoFile ? scene.videoFile.name : 'Klicken Sie hier oder ziehen Sie eine Videodatei hierher'}
                                            </div>
                                            <input 
                                                type="file" 
                                                accept="video/*" 
                                                className="hidden" 
                                                id={`video-upload-${scene.id}`}
                                                onChange={(e) => {
                                                    const file = e.target.files[0];
                                                    if (file) updateScene(scene.id, { videoFile: file });
                                                }}
                                            />
                                            <label 
                                                htmlFor={`video-upload-${scene.id}`}
                                                className="cursor-pointer inline-block mt-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700"
                                            >
                                                Video auswählen
                                            </label>
                                        </div>
                                        
                                        <div className="mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-md">
                                            <label className="flex items-start">
                                                <input
                                                    type="checkbox"
                                                    checked={scene.rightsConfirmed || false}
                                                    onChange={(e) => updateScene(scene.id, { rightsConfirmed: e.target.checked })}
                                                    className="mr-2 mt-1 flex-shrink-0"
                                                    required
                                                />
                                                <span className="text-xs text-yellow-800">
                                                    <strong>Rechtliche Bestätigung:</strong> Ich bestätige, dass ich über alle erforderlichen Rechte an diesem Video verfüge und es für kommerzielle/öffentliche Zwecke verwenden darf.
                                                </span>
                                            </label>
                                        </div>
                                    </div>
                                )}

                                {(scene.type === 'image-overlay' || scene.type === 'image-avatar') && (
                                    <div>
                                        <div className="mb-4">
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Bild hochladen</label>
                                            <div className="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-gray-400 transition-colors">
                                                <div className="text-3xl mb-2">🖼️</div>
                                                <div className="text-sm text-gray-600">
                                                    {scene.imageFile ? scene.imageFile.name : 'Bild auswählen'}
                                                </div>
                                                <input 
                                                    type="file" 
                                                    accept="image/*" 
                                                    className="hidden"
                                                    id={`image-upload-${scene.id}`}
                                                    onChange={(e) => {
                                                        const file = e.target.files[0];
                                                        if (file) updateScene(scene.id, { imageFile: file });
                                                    }}
                                                />
                                                <label 
                                                    htmlFor={`image-upload-${scene.id}`}
                                                    className="cursor-pointer inline-block mt-2 bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700"
                                                >
                                                    Bild wählen
                                                </label>
                                            </div>
                                            
                                            <div className="mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-md">
                                                <label className="flex items-start">
                                                    <input
                                                        type="checkbox"
                                                        checked={scene.rightsConfirmed || false}
                                                        onChange={(e) => updateScene(scene.id, { rightsConfirmed: e.target.checked })}
                                                        className="mr-2 mt-1 flex-shrink-0"
                                                        required
                                                    />
                                                    <span className="text-xs text-yellow-800">
                                                        <strong>Rechtliche Bestätigung:</strong> Ich bestätige, dass ich über alle erforderlichen Rechte an diesem Bild verfüge.
                                                    </span>
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <div className="mb-4">
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Text-Overlay</label>
                                            <input
                                                type="text"
                                                value={scene.overlayText || ''}
                                                placeholder="Text der im Bild angezeigt wird"
                                                className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                onChange={(e) => updateScene(scene.id, { overlayText: e.target.value })}
                                            />
                                        </div>
                                        
                                        <div className="mb-4">
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Sprechtext</label>
                                            <textarea
                                                rows="3"
                                                value={scene.speechText || ''}
                                                placeholder="Text der gesprochen werden soll"
                                                className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                onChange={(e) => updateScene(scene.id, { speechText: e.target.value })}
                                            />
                                        </div>
                                        
                                        <div className="mb-4">
                                            <label className="flex items-center">
                                                <input
                                                    type="checkbox"
                                                    checked={scene.animateImage || false}
                                                    className="mr-2"
                                                    onChange={(e) => updateScene(scene.id, { animateImage: e.target.checked })}
                                                />
                                                <span className="text-sm font-medium text-gray-700">Bild animieren</span>
                                            </label>
                                        </div>

                                        {scene.type === 'image-avatar' && (
                                            <div>
                                                <div className="mb-4">
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">Avatar auswählen</label>
                                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                                                        {avatars.map(avatar => (
                                                            <div key={avatar.id} className="relative">
                                                                <button
                                                                    onClick={() => updateScene(scene.id, { selectedAvatar: avatar.id })}
                                                                    className={`w-full p-3 border-2 rounded-lg transition-all ${
                                                                        scene.selectedAvatar === avatar.id 
                                                                            ? 'border-blue-500 bg-blue-50 shadow-md' 
                                                                            : 'border-gray-200 hover:border-gray-300 hover:shadow-sm'
                                                                    }`}
                                                                >
                                                                    <img 
                                                                        src={avatar.image} 
                                                                        alt={avatar.name}
                                                                        className="w-full h-20 object-cover rounded-md mb-2"
                                                                        onError={(e) => {
                                                                            e.target.src = `https://via.placeholder.com/80x80/4F46E5/FFFFFF?text=${avatar.name.split(' ').map(n => n[0]).join('')}`;
                                                                        }}
                                                                    />
                                                                    <span className="text-xs font-medium text-gray-700 block">{avatar.name}</span>
                                                                </button>
                                                                <a
                                                                    href={avatar.videoUrl}
                                                                    target="_blank"
                                                                    rel="noopener noreferrer"
                                                                    className="absolute top-1 right-1 w-7 h-7 bg-blue-500 hover:bg-blue-600 rounded-full flex items-center justify-center text-white shadow-sm transition-colors"
                                                                    title={`${avatar.name} Beispiel Video ansehen`}
                                                                >
                                                                    ▶️
                                                                </a>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>

                                                <div className="mb-4">
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">Avatar Position</label>
                                                    <div className="grid grid-cols-3 gap-3">
                                                        {[
                                                            { value: 'left', label: 'Links', icon: '←' },
                                                            { value: 'center', label: 'Mitte', icon: '↑' },
                                                            { value: 'right', label: 'Rechts', icon: '→' }
                                                        ].map(position => (
                                                            <button
                                                                key={position.value}
                                                                onClick={() => updateScene(scene.id, { avatarPosition: position.value })}
                                                                className={`p-3 border-2 rounded-lg text-center transition-all ${
                                                                    scene.avatarPosition === position.value 
                                                                        ? 'border-blue-500 bg-blue-50' 
                                                                        : 'border-gray-200 hover:border-gray-300'
                                                                }`}
                                                            >
                                                                <div className="text-2xl mb-1">{position.icon}</div>
                                                                <div className="text-sm font-medium">{position.label}</div>
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>

                                                <div className="mb-4">
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">Avatar Art</label>
                                                    <div className="grid grid-cols-2 gap-3">
                                                        <button
                                                            onClick={() => updateScene(scene.id, { avatarType: 'face' })}
                                                            className={`p-4 border-2 rounded-lg text-center transition-all ${
                                                                scene.avatarType === 'face' 
                                                                    ? 'border-blue-500 bg-blue-50' 
                                                                    : 'border-gray-200 hover:border-gray-300'
                                                            }`}
                                                        >
                                                            <div className="text-2xl mb-2">😊</div>
                                                            <div className="text-sm font-medium">Nur Gesicht</div>
                                                        </button>
                                                        <button
                                                            onClick={() => updateScene(scene.id, { avatarType: 'fullbody' })}
                                                            className={`p-4 border-2 rounded-lg text-center transition-all ${
                                                                scene.avatarType === 'fullbody' 
                                                                    ? 'border-blue-500 bg-blue-50' 
                                                                    : 'border-gray-200 hover:border-gray-300'
                                                            }`}
                                                        >
                                                            <div className="text-2xl mb-2">🚶</div>
                                                            <div className="text-sm font-medium">Ganzer Körper</div>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {scene.type === 'ai-video' && (
                                    <div>
                                        <div className="mb-4">
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Avatar auswählen</label>
                                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                                {avatars.map(avatar => (
                                                    <div key={avatar.id} className="relative">
                                                        <button
                                                            onClick={() => updateScene(scene.id, { selectedAvatar: avatar.id })}
                                                            className={`w-full aspect-square p-3 border-2 rounded-lg transition-all ${
                                                                scene.selectedAvatar === avatar.id 
                                                                    ? 'border-blue-500 bg-blue-50 shadow-md' 
                                                                    : 'border-gray-200 hover:border-gray-300 hover:shadow-sm'
                                                            }`}
                                                        >
                                                            <img 
                                                                src={avatar.image} 
                                                                alt={avatar.name}
                                                                className="w-full h-full object-cover rounded-md mb-2"
                                                                onError={(e) => {
                                                                    e.target.src = `https://via.placeholder.com/120x120/4F46E5/FFFFFF?text=${avatar.name.split(' ').map(n => n[0]).join('')}`;
                                                                }}
                                                            />
                                                            <span className="text-xs font-medium text-gray-700 block absolute bottom-1 left-1 right-1 bg-white bg-opacity-90 rounded px-1 py-1 text-center">{avatar.name}</span>
                                                        </button>
                                                        <a
                                                            href={avatar.videoUrl}
                                                            target="_blank"
                                                            rel="noopener noreferrer"
                                                            className="absolute top-1 right-1 w-6 h-6 bg-blue-500 hover:bg-blue-600 rounded-full flex items-center justify-center text-white shadow-lg transition-colors text-xs"
                                                            title={`${avatar.name} Beispiel Video ansehen`}
                                                        >
                                                            ▶
                                                        </a>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        
                                        <div className="mb-4">
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Avatar Beschreibung (Prompt)</label>
                                            <textarea
                                                rows="4"
                                                value={scene.aiDescription || ''}
                                                placeholder="Beschreiben Sie, was der Avatar tun soll (z.B. 'Der Avatar steht in einem modernen Büro und erklärt die neuen Verkaufszahlen mit enthusiastischer Gestik')"
                                                className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                onChange={(e) => updateScene(scene.id, { aiDescription: e.target.value })}
                                            />
                                        </div>
                                    </div>
                                )}

                                {/* Status and Generate Button */}
                                <div className="flex justify-between items-center mt-6">
                                    {/* Status Indicator */}
                                    <div>
                                        {scene.status === 'generating' && (
                                            <div className="flex items-center text-orange-600">
                                                <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-orange-600 mr-2"></div>
                                                Generiert...
                                            </div>
                                        )}
                                        {scene.status === 'completed' && (
                                            <div className="flex items-center gap-2">
                                                <span className="text-green-600">✅</span>
                                                <button
                                                    onClick={() => setPreviewScene(scene)}
                                                    className="text-blue-600 hover:text-blue-800 flex items-center gap-1"
                                                >
                                                    👁️ Vorschau
                                                </button>
                                                <button
                                                    onClick={() => regenerateScene(scene.id)}
                                                    className="text-gray-600 hover:text-gray-800 flex items-center gap-1"
                                                >
                                                    🔄 Neu generieren
                                                </button>
                                            </div>
                                        )}
                                        {scene.status === 'error' && (
                                            <div className="flex items-center gap-2">
                                                <span className="text-red-600">❌</span>
                                                <span className="text-red-600">Fehler bei der Generierung</span>
                                                <button
                                                    onClick={() => regenerateScene(scene.id)}
                                                    className="text-blue-600 hover:text-blue-800 flex items-center gap-1"
                                                >
                                                    🔄 Erneut versuchen
                                                </button>
                                            </div>
                                        )}
                                    </div>

                                    {/* Generate Button */}
                                    {scene.status !== 'completed' && scene.status !== 'generating' && (
                                        <button
                                            onClick={() => generateScene(scene.id)}
                                            disabled={
                                                (scene.type === 'video-upload' || scene.type === 'image-overlay' || scene.type === 'image-avatar') 
                                                && !scene.rightsConfirmed
                                            }
                                            className={`px-6 py-2 rounded-md font-medium transition-colors ${
                                                (scene.type === 'video-upload' || scene.type === 'image-overlay' || scene.type === 'image-avatar') 
                                                && !scene.rightsConfirmed
                                                    ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                                    : 'bg-blue-600 hover:bg-blue-700 text-white'
                                            }`}
                                            title={
                                                (scene.type === 'video-upload' || scene.type === 'image-overlay' || scene.type === 'image-avatar') 
                                                && !scene.rightsConfirmed 
                                                    ? 'Bitte bestätigen Sie die rechtlichen Bedingungen'
                                                    : ''
                                            }
                                        >
                                            Generieren
                                        </button>
                                    )}
                                </div>
                            </div>
                        ))}

                        <div className="text-center">
                            <button
                                onClick={addScene}
                                className="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-md font-medium flex items-center gap-2 mx-auto transition-colors"
                            >
                                ➕ Weitere Szene hinzufügen
                            </button>
                        </div>

                        {allScenesCompleted && (
                            <div>
                                {/* Music Selector */}
                                <div className="bg-gradient-to-r from-purple-50 to-blue-50 border-2 border-purple-200 rounded-lg p-6 mb-6">
                                    <div className="flex items-center gap-3 mb-4">
                                        <span className="text-2xl">🎵</span>
                                        <h3 className="text-lg font-semibold text-gray-900">Hintergrundmusik</h3>
                                    </div>
                                    
                                    <div className="mb-4">
                                        <label className="flex items-center">
                                            <input
                                                type="checkbox"
                                                checked={musicEnabled}
                                                onChange={(e) => updateMusicEnabled(e.target.checked)}
                                                className="mr-3 w-4 h-4 text-purple-600"
                                            />
                                            <span className="text-sm font-medium text-gray-700">Hintergrundmusik hinzufügen</span>
                                        </label>
                                    </div>

                                    {musicEnabled && (
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Musik auswählen
                                            </label>
                                            <select
                                                value={selectedMusic}
                                                onChange={(e) => updateSelectedMusic(e.target.value)}
                                                className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent mb-3"
                                            >
                                                <option value="">Bitte wählen...</option>
                                                {backgroundMusic.map(music => (
                                                    <option key={music.id} value={music.id}>
                                                        {music.name} - {music.genre} ({music.duration})
                                                    </option>
                                                ))}
                                            </select>
                                            
                                            {selectedMusic && (
                                                <div className="mt-3 p-3 bg-white rounded-md border">
                                                    <div className="flex items-center justify-between">
                                                        <div>
                                                            <p className="font-medium text-gray-900">
                                                                {backgroundMusic.find(m => m.id === selectedMusic)?.name}
                                                            </p>
                                                            <p className="text-sm text-gray-600">
                                                                {backgroundMusic.find(m => m.id === selectedMusic)?.genre} • {backgroundMusic.find(m => m.id === selectedMusic)?.duration}
                                                            </p>
                                                        </div>
                                                        <button
                                                            onClick={() => playMusic(selectedMusic)}
                                                            className={`flex items-center gap-2 px-3 py-1 rounded-md transition-colors ${
                                                                playingMusic === selectedMusic 
                                                                    ? 'bg-red-100 text-red-700' 
                                                                    : 'bg-green-100 text-green-700 hover:bg-green-200'
                                                            }`}
                                                        >
                                                            {playingMusic === selectedMusic ? (
                                                                <span>🔊 Spielt...</span>
                                                            ) : (
                                                                <span>▶️ Anhören</span>
                                                            )}
                                                        </button>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>

                                {/* Merge Videos */}
                                <div className="bg-green-50 border-2 border-green-200 rounded-lg p-6 text-center">
                                    <h3 className="text-lg font-semibold text-green-800 mb-3">
                                        Alle Szenen sind fertig generiert!
                                    </h3>
                                    <button
                                        onClick={mergeVideos}
                                        className="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-md font-medium text-lg transition-colors"
                                    >
                                        📹 Videobausteine zusammenführen
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Admin Panel */}
                    {showAdmin && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-gray-900">⚙️ Webhook Konfiguration</h2>
                                    <button
                                        onClick={() => setShowAdmin(false)}
                                        className="text-gray-400 hover:text-gray-600"
                                    >
                                        ❌
                                    </button>
                                </div>
                                
                                <div className="space-y-4">
                                    {Object.entries(webhooks).map(([key, value]) => {
                                        const labels = {
                                            'video-upload': 'Video Upload Webhook',
                                            'image-overlay': 'Bild mit Overlay Webhook',
                                            'image-avatar': 'Bild mit Avatar Webhook',
                                            'ai-video': 'KI Video Webhook',
                                            'merge': 'Video Zusammenführen Webhook'
                                        };
                                        const placeholders = {
                                            'video-upload': './api/webhooks/video-upload.php',
                                            'image-overlay': './api/webhooks/image-overlay.php',
                                            'image-avatar': './api/webhooks/image-avatar.php',
                                            'ai-video': './api/webhooks/ai-video.php',
                                            'merge': './api/webhooks/merge-videos.php'
                                        };
                                        return (
                                            <div key={key}>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                                    {labels[key]}
                                                </label>
                                                <input
                                                    type="url"
                                                    value={value}
                                                    onChange={(e) => updateWebhooks({...webhooks, [key]: e.target.value})}
                                                    className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    placeholder={placeholders[key]}
                                                />
                                            </div>
                                        );
                                    })}
                                </div>
                                
                                <div className="mt-6 flex justify-between items-center">
                                    <div className="text-sm text-gray-600">
                                        💾 Einstellungen werden automatisch gespeichert
                                    </div>
                                    <button
                                        onClick={() => setShowAdmin(false)}
                                        className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md font-medium"
                                    >
                                        Schließen
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Preview Modal */}
                    {previewScene && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white rounded-lg p-6 max-w-2xl w-full mx-4">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-semibold">📺 Video Vorschau</h3>
                                    <button
                                        onClick={() => setPreviewScene(null)}
                                        className="text-gray-400 hover:text-gray-600"
                                    >
                                        ❌
                                    </button>
                                </div>
                                <div className="bg-gray-200 rounded-lg p-8 text-center">
                                    <div className="text-6xl mb-4">📺</div>
                                    <p className="text-gray-600">Video Player würde hier angezeigt</p>
                                    <p className="text-sm text-gray-500 mt-2">URL: {previewScene.videoUrl}</p>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const container = document.getElementById('root');
        const root = createRoot(container);
        root.render(<VideoSceneGenerator />);
    </script>
</body>
</html>